<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Submit Feedback</title>
    <link rel="stylesheet" href="join-styles.css">
</head>
<body>
    <div class="wave-wrapper">
        <svg class="waves" viewBox="0 24 150 28" preserveAspectRatio="none">
            <defs><path id="w" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs>
            <g class="parallax">
                <use href="#w" x="48" y="0" fill="rgba(255,255,255,0.7)"/><use href="#w" x="48" y="3" fill="rgba(255,255,255,0.5)"/><use href="#w" x="48" y="5" fill="rgba(255,255,255,0.3)"/><use href="#w" x="48" y="7" fill="rgba(255,255,255,0.1)"/>
            </g>
        </svg>
    </div>

    <div class="glass-card" id="formContainer">
        <h1 id="appName">Feedback</h1>
        <p class="subtitle">Share your thoughts on the experience.</p>
        <form id="feedbackForm">
            <input type="text" id="name" placeholder="Your Name" required>
            <textarea id="content" placeholder="How can we make this better?" rows="4" required></textarea>
            <button type="submit" class="submit-btn">Send Feedback</button>
        </form>
    </div>

    <script type="module">
        import { supabase } from './supabase.js';
        const params = new URLSearchParams(window.location.search);
        const appId = params.get('appId');

        async function init() {
            if (!appId) return;
            const { data } = await supabase.from('apps').select('name').eq('id', appId).single();
            if (data) document.getElementById('appName').innerText = `${data.name} Feedback`;
        }

        document.getElementById('feedbackForm').onsubmit = async (e) => {
            e.preventDefault();
            const { error } = await supabase.from('feedback').insert([{
                app_id: appId,
                user_name: document.getElementById('name').value,
                content: document.getElementById('content').value
            }]);
            if (!error) {
                document.getElementById('formContainer').innerHTML = `<h1>Thank you.</h1><p class="subtitle">Feedback sent successfully.</p>`;
            }
        };
        init();
    </script>
</body>
</html>
