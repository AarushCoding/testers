<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Join Testing Team</title>
    <link rel="stylesheet" href="join-styles.css">
</head>
<body>
    <div class="wave-wrapper">
        <svg class="waves" viewBox="0 24 150 28" preserveAspectRatio="none">
            <defs><path id="w" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs>
            <g class="parallax">
                <use href="#w" x="48" y="0" fill="rgba(255,255,255,0.7)"/><use href="#w" x="48" y="3" fill="rgba(255,255,255,0.5)"/><use href="#w" x="48" y="5" fill="rgba(255,255,255,0.3)"/><use href="#w" x="48" y="7" fill="rgba(255,255,255,0.1)"/>
            </g>
        </svg>
    </div>

    <div class="glass-card" id="formContainer">
        <h1 id="appName">Join Testing</h1>
        <p class="subtitle">Enter your details to register as a tester.</p>
        <form id="joinForm">
            <input type="text" id="name" placeholder="Full Name" required>
            <input type="email" id="email" placeholder="Email Address" required>
            <button type="submit" class="submit-btn">Get Access</button>
        </form>
    </div>

    <script type="module">
        import { supabase } from './supabase.js';
        const params = new URLSearchParams(window.location.search);
        const appId = params.get('appId');

        async function init() {
            if (!appId) return;
            const { data } = await supabase.from('apps').select('name').eq('id', appId).single();
            if (data) document.getElementById('appName').innerText = `Join ${data.name}`;
        }

        document.getElementById('joinForm').onsubmit = async (e) => {
            e.preventDefault();
            const { error } = await supabase.from('testers').insert([{
                app_id: appId,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value
            }]);
            if (!error) {
                document.getElementById('formContainer').innerHTML = `<h1>Success.</h1><p class="subtitle">You're on the list!</p>`;
            }
        };
        init();
    </script>
</body>
</html>
